{"meta":{"type":"db","canSave":true,"canEdit":true,"canAdmin":true,"canStar":true,"canDelete":true,"slug":"pol-zovatel-skaja-statistika","url":"/d/fe2gi9gfxatc0d/pol-zovatel-skaja-statistika","expires":"0001-01-01T00:00:00Z","created":"2024-10-30T18:28:25Z","updated":"2024-11-01T04:09:12Z","updatedBy":"admin","createdBy":"admin","version":15,"hasAcl":false,"isFolder":false,"folderId":0,"folderUid":"","folderTitle":"General","folderUrl":"","provisioned":false,"provisionedExternalId":"","annotationsPermissions":{"dashboard":{"canAdd":true,"canEdit":true,"canDelete":true},"organization":{"canAdd":true,"canEdit":true,"canDelete":true}}},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":{"type":"grafana","uid":"-- Grafana --"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"},{"datasource":{"type":"influxdb","uid":"fe2ght1dv8oaof"},"enable":true,"hide":false,"iconColor":"red","name":"New annotation"}]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":2,"id":1,"links":[],"panels":[{"datasource":{"uid":"fe2ght1dv8oaof"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"auto","cellOptions":{"type":"auto"},"inspect":false},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[]},"gridPos":{"h":9,"w":17,"x":0,"y":0},"id":3,"options":{"cellHeight":"sm","footer":{"countRows":false,"fields":"","reducer":["sum"],"show":false},"showHeader":true},"pluginVersion":"11.3.0","targets":[{"query":"firstT = from(bucket: \"example\")\n  |\u003E range(start: time(v: 0))\n  |\u003E filter(fn: (r) =\u003E r._measurement == \"user-clicks\")\n  |\u003E group(columns: [\"sessionId\"])\n  |\u003E first()\n\nlastT = from(bucket: \"example\")\n  |\u003E range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |\u003E filter(fn: (r) =\u003E r._measurement == \"user-clicks\")\n  |\u003E group(columns: [\"sessionId\"])\n  |\u003E last()\n\njoin(\n    tables: {first: firstT, last: lastT },\n    on: [\"sessionId\"]\n  )\n  |\u003E group()\n  |\u003E map(fn: (r) =\u003E {\n    diff = uint(v: r._time_last) - uint(v: r._time_first)\n    return {\n      sessionId: r.sessionId, \n      first: r._time_first,\n      last: r._time_last,\n      diff: string(v: duration(v: diff)),\n      _diff: diff\n    }\n  })\n  |\u003E sort(columns: [\"_diff\"], desc: true)","refId":"A"}],"title":"Длительность сессии пользователя","transformations":[{"id":"organize","options":{"excludeByName":{"_diff":true},"includeByName":{},"indexByName":{"_diff":4,"diff":3,"first":1,"last":2,"sessionId":0},"renameByName":{}}}],"type":"table"},{"datasource":{"type":"influxdb","uid":"fe2ght1dv8oaof"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","fillOpacity":80,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineWidth":1,"scaleDistribution":{"type":"linear"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":9},"id":1,"options":{"barRadius":0,"barWidth":0.97,"fullHighlight":false,"groupWidth":0.7,"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"orientation":"horizontal","showValue":"auto","stacking":"none","tooltip":{"mode":"single","sort":"none"},"xTickLabelRotation":0,"xTickLabelSpacing":0},"pluginVersion":"11.3.0","targets":[{"datasource":{"type":"influxdb","uid":"fe2ght1dv8oaof"},"query":"import \"strings\"\nfrom(bucket: \"example\")\n\t|\u003E range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |\u003E filter(fn: (r) =\u003E r[\"_measurement\"] == \"user-clicks\")\n  |\u003E filter(fn: (r) =\u003E contains(value: r[\"event\"], set: [\"addBasket\", \"loadBasket\", \"delBasket\"]))\n  |\u003E group(columns: [\"sessionId\"])\n  |\u003E last()\n  |\u003E group()\n  |\u003E map(fn: (r) =\u003E ({r with size: length(arr: strings.split(t: \",\", v: r.basket))}))\n  |\u003E keep(columns: [\"sessionId\", \"size\"])","refId":"A"}],"title":"Размер корзины пользователей","type":"barchart"},{"datasource":{"type":"influxdb","uid":"fe2ght1dv8oaof"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[]},"gridPos":{"h":8,"w":5,"x":12,"y":9},"id":2,"options":{"minVizHeight":75,"minVizWidth":75,"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true,"sizing":"auto"},"pluginVersion":"11.3.0","targets":[{"query":"from(bucket: \"example\")\n\t|\u003E range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |\u003E filter(fn: (r) =\u003E r[\"_measurement\"] == \"user-clicks\")\n  |\u003E filter(fn: (r) =\u003E r[\"event\"] == \"pageview\")\n  |\u003E group(columns: [\"sessionId\"])\n  |\u003E distinct(column: \"sessionId\")\n  |\u003E group()\n  |\u003E count()\n  |\u003E group()\n  |\u003E yield(name: \"users\")","refId":"A"}],"title":"Всего пользователей","type":"gauge"}],"preload":false,"schemaVersion":40,"tags":[],"templating":{"list":[{"current":{"text":"","value":""},"name":"query0","options":[],"query":"","refresh":1,"regex":"","type":"query"}]},"timepicker":{},"timezone":"browser","title":"Пользовательская статистика","uid":"fe2gi9gfxatc0d","version":15,"weekStart":""}}